---

  - name: Ensure web root directory exists
    ansible.builtin.file:
      path: /var/www/example.internal/html
      state: directory
      owner: root
      group: root
      mode: '0755'
    register: dir_res

  - name: Print the value of dir_res
    ansible.builtin.debug:
      var: dir_res
    when: dir_res is changed

  - name: Deploy index.html
    ansible.builtin.copy:
      src: index.html
      dest: /var/www/example.internal/html/index.html
      owner: root
      group: root
      mode: '0644'
    register: html_res

  - name: Print the value of html_res
    ansible.builtin.debug:
      var: html_res
    when: html_res is changed

  - name: Copy HTTPS configuration
    ansible.builtin.copy:
      src: https.conf
      dest: /etc/nginx/conf.d/https.conf
      owner: root
      group: root
      mode: '0644'
    register: https_res

  - name: Print the value of https_res
    ansible.builtin.debug:
      var: https_res
    when: https_res is changed

  - name: Deploy nginx configuration from template
    ansible.builtin.template:
      src: templates/example.internal.conf.j2
      dest: /etc/nginx/conf.d/example.internal.conf
      owner: root
      group: root
      mode: '0644'
    register: nginx_res


  - name: Print the value of nginx_res
    ansible.builtin.debug:
      var: nginx_res
    when: nginx_res is changed

  - name: Ensure nginx key file has correct permissions
    ansible.builtin.file:
      path: /etc/pki/nginx/private/server.key
      owner: root
      group: nginx
      mode: '0640'

  - name: Reload nginx
    ansible.builtin.service:
      name: nginx
      state: reloaded
